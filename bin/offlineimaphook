notmuch new

# untag notify from emails in  Conversation History and Sent Items
notmuch tag --batch <<EOF
-notify folder:"Sent Items"
-notify folder:"Conversation History"
EOF

if [[ $(notmuch search tag:notify) ]]; then
    notmuch search --format=json 'tag:notify' | jq -r '.[] | "\nFrom: \(.authors)\n\(.subject)"' | xargs -0 -I message notify-send "New mail" "message"

    # Untag email etc. here
    notmuch tag --batch <<EOF
    -notify tag:notify
EOF
fi
