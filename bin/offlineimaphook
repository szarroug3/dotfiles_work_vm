#!/bin/bash
new_dir="$HOME/Mail/*/new"
num_mail=$(ls $new_dir|wc -l)
message=""

if [[ $num_mail -gt 0 ]];then
    for i in $new_dir/*;do
        folder=$(basename $(dirname $(dirname $i)))
        message="$message\n($folder) $(grep -m1 '^From: ' $i|sed 's/From: //'|sed 's/ <[^>]*>//')\n$(grep -m1 '^Subject: ' $i|sed 's/Subject: //')\n"
    done
    notify-send "New Mail" "$message" -t 5000 &
fi

notmuch new &
